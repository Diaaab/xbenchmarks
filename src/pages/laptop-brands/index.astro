---
import Layout from "../../layouts/Layout.astro";
import laptops from "../../data/laptops.json";
import { getBrand, slugify } from "../../utils/data-helpers";

// Extract unique brands with case-insensitive deduplication
const brandMap = new Map();
laptops.forEach((laptop) => {
    const brand = getBrand(laptop.name);
    const key = brand.toLowerCase();

    if (!brandMap.has(key)) {
        brandMap.set(key, brand);
    } else {
        // If we have an existing entry but the new one is all uppercase, prefer it
        // (e.g. Prefer "ASUS" over "Asus")
        const current = brandMap.get(key);
        if (brand !== current && brand === brand.toUpperCase()) {
            brandMap.set(key, brand);
        }
    }
});

const brands = Array.from(brandMap.values()).sort();
---

<Layout title="Laptop Brands - Electrical Escape">
    <h1>Laptop Brands</h1>
    <p>Select a brand to view available series and models.</p>

    <div
        class="grid"
        style="grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); margin-top: var(--space-6);"
    >
        {
            brands.map((brand) => (
                <a
                    href={`${import.meta.env.BASE_URL}/laptop-brands/${slugify(brand)}`}
                    class="brand-card"
                >
                    <div class="logo-container">
                        <img
                            src={`${import.meta.env.BASE_URL}/brands/${brand.toLowerCase()}-brand.png`}
                            alt={`${brand} Logo`}
                            loading="lazy"
                            onerror="this.style.display='none'"
                        />
                    </div>
                    <span class="brand-name">{brand}</span>
                </a>
            ))
        }
    </div>
</Layout>

<style>
    .brand-card {
        border: var(--border-primary);
        padding: var(--space-6);
        text-align: center;
        text-decoration: none;
        color: var(--color-text);
        font-weight: 600;
        font-size: var(--text-lg);
        transition: all 0.2s ease;
        background: var(--color-bg);
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: var(--space-4);
        border-radius: var(--radius-md);
    }

    .brand-card:hover {
        background-color: var(--color-surface);
        text-decoration: none;
        transform: translateY(-4px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        border-color: var(--color-border-hover);
    }

    .logo-container {
        width: 100%;
        aspect-ratio: 3/2;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: var(--space-4);
        background: white;
        border-radius: var(--radius-sm);
        overflow: hidden;
    }

    .logo-container img {
        width: 100%;
        height: 100%;
        object-fit: contain;
        transition: transform 0.3s ease;
    }

    .brand-card:hover .logo-container img {
        transform: scale(1.05);
    }

    .brand-name {
        margin-top: auto;
    }
</style>
